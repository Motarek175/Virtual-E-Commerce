import{a as ue}from"./chunk-WQ74LAME.js";import{c as te,g as re,m as ie,n as ne,o as ae,t as oe}from"./chunk-GFUF5DTM.js";import{a as E,b as ee,n as se,o as de}from"./chunk-HD3FFQXR.js";import{h as Y,i as J,j as K,n as Q,o as X,q as Z}from"./chunk-MMZLANRT.js";import{Aa as W,B as O,Bb as q,Fa as n,Ga as N,Gb as V,Hb as S,Ib as F,Jb as A,S as B,Ta as u,Va as l,X as U,Xa as I,_ as $,a as D,b as j,bb as a,cb as o,db as _,e as T,ha as h,hb as y,ia as f,ja as C,ka as M,kb as g,lb as c,ob as z,q as v,t as w,tb as d,ub as P,vb as m,wb as H,xb as R,yb as G,zb as L}from"./chunk-4Z7TEFED.js";var x=T(ue()),pe=T(se());var le=T(se());var k=class r{constructor(t){this.http=t}assignedOrdersUrl="https://aston.runasp.net/api/DeliveryPerson/GetAssignedOrders";orderDetailsUrl="https://aston.runasp.net/api/DeliveryPerson/GetOrderDetails";updateStatusUrl="https://aston.runasp.net/api/DeliveryPerson/UpdateOrderStatus";getAssignedOrders(){let t=localStorage.getItem("token");if(!t)return v(()=>new Error("No token found"));let e;try{e=(0,le.jwtDecode)(t).ID}catch{return v(()=>new Error("Invalid token"))}let s=new E({Authorization:`Bearer ${t}`});return this.http.get(`${this.assignedOrdersUrl}?deliveryPersonId=${e}`,{headers:s}).pipe(w(i=>{if(i&&typeof i=="object"&&"message"in i)throw new Error(i.message);return i.map(p=>({id:p.id.toString(),customerName:p.userName,deliveryAddress:p.address,status:this.mapNumericStatus(p.status),customerId:p.customerId,phone:p.phone,items:[],orderDate:void 0}))}),O(i=>(console.error("Error fetching orders:",i),v(()=>new Error(i.message||"Failed to fetch orders")))))}getOrderById(t){return this.getOrderDetails(t).pipe(w(e=>e||void 0),O(e=>(console.error("Error fetching order details:",e),v(()=>new Error("Failed to fetch order details")))))}getOrderDetails(t){let e=localStorage.getItem("token");if(!e)return v(()=>new Error("No token found"));let s=new E({Authorization:`Bearer ${e}`});return this.http.get(`${this.orderDetailsUrl}?orderId=${t}`,{headers:s}).pipe(w(i=>({id:i.id.toString(),customerName:i.userName,deliveryAddress:i.address,status:this.mapStringStatus(i.status),customerId:i.customerId,phone:i.phone,totalPrice:i.totalPrice,items:i.productsName.map((p,b)=>({name:p,quantity:i.quantity[b],color:i.color[b],size:i.size[b],image:i.image[b]})),orderDate:void 0})),O(i=>(console.error("Error fetching order details:",i),v(()=>new Error("Failed to fetch order details")))))}updateOrderStatus(t,e){let s=localStorage.getItem("token");if(!s)return v(()=>new Error("No token found"));let i=new E({Authorization:`Bearer ${s}`,"Content-Type":"application/json"}),p={orderId:parseInt(t),newStatus:this.mapStatusToApi(e)};return this.http.put(this.updateStatusUrl,p,{headers:i,responseType:"text"}).pipe(O(b=>(console.error("Error updating order status:",b),v(()=>new Error("Failed to update order status")))))}mapNumericStatus(t){switch(t){case 0:return"pending";case 1:return"preparing";case 2:return"in-progress";case 3:return"recieved";default:return"pending"}}mapStringStatus(t){switch(t.toLowerCase()){case"pending":return"pending";case"preparing":return"preparing";case"onway":return"in-progress";case"recieved":return"recieved";default:return"pending"}}mapStatusToApi(t){switch(t){case"pending":return"Pending";case"preparing":return"Preparing";case"in-progress":return"OnWay";case"recieved":return"Recieved";default:return"Pending"}}static \u0275fac=function(e){return new(e||r)(U(ee))};static \u0275prov=B({token:r,factory:r.\u0275fac,providedIn:"root"})};var me=(r,t,e,s)=>({"bg-yellow-100 text-yellow-800":r,"bg-orange-100 text-orange-800":t,"bg-blue-100 text-blue-800":e,"bg-green-100 text-green-800":s});function _e(r,t){if(r&1&&(a(0,"div",21)(1,"h1",22),d(2),o(),a(3,"p",23),d(4,' Manage your deliveries efficiently. Click "All Orders" in the sidebar to view and track your assigned orders. '),o(),_(5,"img",24),o()),r&2){let e=c();n(2),m(" Welcome ",e.deliveryPersonName," to Delivery Dashboard ")}}function he(r,t){r&1&&(a(0,"div",28),d(1," No order assigned to you yet "),o())}function fe(r,t){if(r&1&&(a(0,"p",39),d(1),S(2,"date"),o()),r&2){let e=c().$implicit;n(),m(" ",A(2,1,e.orderDate,"short")," ")}}function xe(r,t){if(r&1){let e=y();a(0,"div",36),g("click",function(){let i=h(e).$implicit,p=c(3);return f(p.selectOrder(i))}),a(1,"div",37)(2,"div")(3,"h3",38),d(4),o(),a(5,"p",39),d(6),o(),a(7,"p",39),d(8),o()(),a(9,"div",40)(10,"span",41),d(11),S(12,"titlecase"),o(),u(13,fe,3,4,"p",42),o()()()}if(r&2){let e=t.$implicit;n(4),m(" ",e.customerName," "),n(2),P(e.deliveryAddress),n(2),m("Order #",e.id,""),n(2),l("ngClass",V(8,me,e.status==="pending",e.status==="preparing",e.status==="in-progress",e.status==="recieved")),n(),m(" ",e.status==="in-progress"?"On Way":e.status==="recieved"?"Received":F(12,6,e.status)," "),n(2),l("ngIf",e.orderDate)}}function be(r,t){if(r&1){let e=y();a(0,"button",43),g("click",function(){let i=h(e).$implicit,p=c(3);return f(p.changePage(i))}),d(1),o()}if(r&2){let e=t.$implicit,s=c(3);I("bg-[var(--main-color)]",s.currentPage===e)("text-white",s.currentPage===e),n(),m(" ",e," ")}}function ye(r,t){if(r&1){let e=y();a(0,"div"),u(1,xe,14,13,"div",29),a(2,"div",30)(3,"button",31),g("click",function(){h(e);let i=c(2);return f(i.changePage(i.currentPage-1))}),C(),a(4,"svg",32),_(5,"path",33),o()(),u(6,be,2,5,"button",34),M(),a(7,"button",31),g("click",function(){h(e);let i=c(2);return f(i.changePage(i.currentPage+1))}),C(),a(8,"svg",32),_(9,"path",35),o()()()()}if(r&2){let e=c(2);n(),l("ngForOf",e.paginatedOrders),n(2),l("disabled",e.currentPage===1),n(3),l("ngForOf",e.visiblePages),n(),l("disabled",e.currentPage===e.totalPages)}}function Oe(r,t){if(r&1&&(a(0,"div",25)(1,"h1",22),d(2," All Orders "),o(),u(3,he,2,0,"div",26)(4,ye,10,4,"div",27),o()),r&2){let e=c();n(3),l("ngIf",e.orders.length===0),n(),l("ngIf",e.orders.length>0)}}function Se(r,t){if(r&1&&(a(0,"div",53),d(1),o()),r&2){let e=c(2);n(),m(" ",e.errorMessage," ")}}function we(r,t){if(r&1&&(a(0,"p",49),d(1),o()),r&2){let e=c(2);n(),m(" Phone: ",e.selectedOrder.phone," ")}}function Ce(r,t){if(r&1&&(a(0,"p",49),d(1),S(2,"date"),o()),r&2){let e=c(2);n(),m(" Order Date: ",A(2,1,e.selectedOrder.orderDate,"medium")," ")}}function Ie(r,t){if(r&1&&(a(0,"p",49),d(1),o()),r&2){let e=c(2);n(),m(" Total Price: $",e.selectedOrder.totalPrice," ")}}function Pe(r,t){r&1&&(a(0,"option",61),d(1," Preparing "),o())}function Ee(r,t){r&1&&(a(0,"option",62),d(1," On Way "),o())}function ke(r,t){r&1&&(a(0,"option",62),d(1," On Way "),o())}function De(r,t){r&1&&(a(0,"option",63),d(1," Received "),o())}function Te(r,t){if(r&1){let e=y();a(0,"div",54)(1,"label",55),d(2,"Update Status:"),o(),a(3,"select",56),L("ngModelChange",function(i){h(e);let p=c(2);return G(p.selectedOrder.status,i)||(p.selectedOrder.status=i),f(i)}),u(4,Pe,2,0,"option",57)(5,Ee,2,0,"option",58)(6,ke,2,0,"option",58)(7,De,2,0,"option",59),o(),a(8,"button",60),g("click",function(){h(e);let i=c(2);return f(i.saveOrderStatus())}),d(9," Update "),o()()}if(r&2){let e=c(2);n(3),R("ngModel",e.selectedOrder.status),n(),l("ngIf",e.originalStatus==="preparing"),n(),l("ngIf",e.originalStatus==="preparing"),n(),l("ngIf",e.originalStatus==="in-progress"),n(),l("ngIf",e.originalStatus==="in-progress"),n(),l("disabled",!e.isStatusChanged())}}function Me(r,t){r&1&&(a(0,"p",49),d(1," No items available "),o())}function Ne(r,t){if(r&1&&_(0,"img",68),r&2){let e=c().$implicit;z("alt",e.name),l("src",e.image,W)}}function Ve(r,t){if(r&1&&(a(0,"span"),d(1),o()),r&2){let e=c().$implicit;n(),m(" (Color: ",e.color,")")}}function Fe(r,t){if(r&1&&(a(0,"span"),d(1),o()),r&2){let e=c().$implicit;n(),m(" (Size: ",e.size,")")}}function Ae(r,t){if(r&1&&(a(0,"li",66),u(1,Ne,1,2,"img",67),a(2,"div"),d(3),u(4,Ve,2,1,"span",27)(5,Fe,2,1,"span",27),o()()),r&2){let e=t.$implicit;n(),l("ngIf",e.image),n(2),H(" ",e.name," x ",e.quantity," "),n(),l("ngIf",e.color),n(),l("ngIf",e.size)}}function je(r,t){if(r&1&&(a(0,"ul",64),u(1,Ae,6,5,"li",65),o()),r&2){let e=c(2);n(),l("ngForOf",e.selectedOrder.items)}}function Be(r,t){if(r&1){let e=y();a(0,"div",44),u(1,Se,2,1,"div",45),a(2,"button",46),g("click",function(){h(e);let i=c();return f(i.setView("list"))}),C(),a(3,"svg",47),_(4,"path",33),o(),d(5," Back to Orders "),o(),M(),a(6,"h1",22),d(7),o(),a(8,"div",48)(9,"div")(10,"h3",38),d(11,"Customer Details"),o(),a(12,"p",49),d(13),o(),a(14,"p",49),d(15),o(),u(16,we,2,1,"p",50)(17,Ce,3,4,"p",50)(18,Ie,2,1,"p",50),a(19,"p",49),d(20," Status: "),a(21,"span",41),d(22),S(23,"titlecase"),o()(),u(24,Te,10,6,"div",51),o(),a(25,"div")(26,"h3",38),d(27,"Order Items"),o(),u(28,Me,2,0,"p",50)(29,je,2,1,"ul",52),o()()()}if(r&2){let e=c();n(),l("ngIf",e.errorMessage),n(6),m(" Order #",e.selectedOrder.id," "),n(6),m("Name: ",e.selectedOrder.customerName,""),n(2),m(" Address: ",e.selectedOrder.deliveryAddress," "),n(),l("ngIf",e.selectedOrder.phone),n(),l("ngIf",e.selectedOrder.orderDate),n(),l("ngIf",e.selectedOrder.totalPrice),n(3),l("ngClass",V(14,me,e.selectedOrder.status==="pending",e.selectedOrder.status==="preparing",e.selectedOrder.status==="in-progress",e.selectedOrder.status==="recieved")),n(),m(" ",e.selectedOrder.status==="in-progress"?"On Way":e.selectedOrder.status==="recieved"?"Received":F(23,12,e.selectedOrder.status)," "),n(2),l("ngIf",e.originalStatus!=="recieved"&&e.originalStatus!=="pending"),n(4),l("ngIf",!e.selectedOrder.items||e.selectedOrder.items.length===0),n(),l("ngIf",e.selectedOrder.items&&e.selectedOrder.items.length>0)}}var ce=class r{constructor(t,e){this.orderService=t;this._UserAuthService=e}orders=[];selectedOrder=null;originalStatus="";updatedOrders=[];view="home";currentPage=1;ordersPerPage=4;paginatedOrders=[];totalPages=1;visiblePages=[];errorMessage="";deliveryPersonName="";decodedToken;ngOnInit(){let t=localStorage.getItem("token")||"";this.decodedToken=(0,pe.jwtDecode)(t),this.deliveryPersonName=this.decodedToken.Name,this.orderService.getAssignedOrders().subscribe({next:e=>{this.orders=e,this.errorMessage="",this.updatePagination()},error:e=>{this.orders=[],this.errorMessage=e.message||"Failed to load orders. Please try again later.",this.updatePagination(),console.error(e),e.message!=="No orders found for this delivery person."&&x.default.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=x.default.stopTimer,i.onmouseleave=x.default.resumeTimer}}).fire({icon:"error",title:this.errorMessage})}})}selectOrder(t){this.orderService.getOrderById(t.id).subscribe({next:e=>{e?(this.selectedOrder=D({},e),this.originalStatus=e.status,this.view="details",this.errorMessage=""):this.errorMessage="Order details not found."},error:e=>{this.errorMessage="Failed to load order details. Please try again later.",console.error(e),x.default.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=x.default.stopTimer,i.onmouseleave=x.default.resumeTimer}}).fire({icon:"error",title:this.errorMessage})}})}setView(t){this.view=t,(t==="home"||t==="list")&&(this.selectedOrder=null,this.originalStatus="",t==="list"&&this.updatePagination())}isStatusChanged(){if(!this.selectedOrder)return!1;let t=this.originalStatus==="preparing"&&this.selectedOrder.status==="in-progress"||this.originalStatus==="in-progress"&&this.selectedOrder.status==="recieved";return this.selectedOrder.status!==this.originalStatus&&t}saveOrderStatus(){this.selectedOrder&&this.isStatusChanged()&&this.orderService.updateOrderStatus(this.selectedOrder.id,this.selectedOrder.status).subscribe({next:()=>{let t=this.orders.findIndex(e=>e.id===this.selectedOrder.id);t!==-1&&(this.orders[t]=j(D({},this.orders[t]),{status:this.selectedOrder.status})),this.updatedOrders=[...this.updatedOrders.filter(e=>e.id!==this.selectedOrder.id),{id:this.selectedOrder.id,status:this.selectedOrder.status}],console.log("Updated orders:",this.updatedOrders),this.originalStatus=this.selectedOrder?.status||"",this.updatePagination(),this.errorMessage=""},error:t=>{this.errorMessage="Failed to update order status. Please try again.",console.error(t)}})}updatePagination(){this.totalPages=Math.ceil(this.orders.length/this.ordersPerPage),this.currentPage=Math.min(this.currentPage,this.totalPages||1);let t=(this.currentPage-1)*this.ordersPerPage;this.paginatedOrders=this.orders.slice(t,t+this.ordersPerPage);let e=4,s=this.currentPage,i=Math.min(this.totalPages,s+e-1);if(i-s+1<e&&(s=Math.max(1,i-e+1)),this.visiblePages=[],this.orders.length>0)for(let p=s;p<=i;p++)this.visiblePages.push(p)}changePage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.updatePagination())}static \u0275fac=function(e){return new(e||r)(N(k),N(de))};static \u0275cmp=$({type:r,selectors:[["app-dashboard"]],standalone:!0,features:[q],decls:33,vars:10,consts:[[1,"flex","flex-col","md:flex-row"],[1,"relative"],[1,"w-full","md:min-h-[100vh]","md:w-84","bg-[var(--main-color)]","text-white"],[1,"p-4","pb-0"],[1,"text-xl","font-bold","mb-4"],[1,"block","p-2","rounded","cursor-pointer","transition-all","duration-300","hover:bg-gray-600","hover:shadow-md",3,"click"],[1,"fa-solid","fa-home","mr-2"],[1,"fa-solid","fa-truck","mr-2"],[1,"flex","w-full","flex-col","gap-3","px-4","pb-4","pt-0","md:p-4","bg-[var(--main-color)]","relative","md:absolute","md:bottom-0"],[1,"md:flex-row","hidden","md:flex"],[1,"w-12","h-12","bg-white","rounded-full","flex","flex-row","items-center","justify-center","text-[var(--main-color)]","font-bold","text-xl"],[1,"flex","flex-row","items-center","justify-between","flex-1"],[1,"ml-3"],[1,"font-semibold","text-lg"],[1,"text-sm","text-gray-300"],[1,"text-xl","cursor-pointer",3,"click"],[1,"fa-solid","fa-arrow-right-from-bracket","text-2xl"],[1,"p-4","w-full"],["class","px-4 animate-fade-in",4,"ngIf"],["class","grid gap-4 animate-fade-in",4,"ngIf"],["class","p-4 border rounded-lg bg-white shadow-sm animate-fade-in",4,"ngIf"],[1,"px-4","animate-fade-in"],[1,"text-3xl","font-bold","mb-4","text-gray-800","tracking-tight"],[1,"text-gray-600","mb-6","leading-relaxed"],["src","./assets/welcome.jpg","alt","Welcome",1,"mx-auto","w-[400px]","rounded-lg"],[1,"grid","gap-4","animate-fade-in"],["class","p-4 bg-red-100 text-red-700 rounded-lg mb-4 animate-fade-in text-center",4,"ngIf"],[4,"ngIf"],[1,"p-4","bg-red-100","text-red-700","rounded-lg","mb-4","animate-fade-in","text-center"],["class","p-4 border rounded-lg cursor-pointer bg-white shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1",3,"click",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-center","items-center","gap-2"],[1,"p-2","text-[var(--main-color)]","cursor-pointer","rounded","disabled:cursor-not-allowed","transition-all","duration-300",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["class","px-3 py-1 rounded-full transition-all duration-300 w-10 h-10 cursor-pointer",3,"bg-[var(--main-color)]","text-white","click",4,"ngFor","ngForOf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"p-4","border","rounded-lg","cursor-pointer","bg-white","shadow-sm","hover:shadow-md","transition-all","duration-300","hover:-translate-y-1",3,"click"],[1,"flex","justify-between"],[1,"font-semibold","text-lg","text-gray-800"],[1,"text-sm","text-gray-500"],[1,"text-right"],[1,"px-2","py-1","rounded","text-sm","font-medium",3,"ngClass"],["class","text-sm text-gray-500",4,"ngIf"],[1,"px-3","py-1","rounded-full","transition-all","duration-300","w-10","h-10","cursor-pointer",3,"click"],[1,"p-4","border","rounded-lg","bg-white","shadow-sm","animate-fade-in"],["class","p-4 bg-red-100 text-red-700 rounded-lg mb-4 animate-fade-in",4,"ngIf"],[1,"mb-4","text-[var(--main-color)]","hover:underline","flex","items-center","cursor-pointer","transition-colors","duration-300","hover:text-[var(--main-color-dark)]",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-4","h-4","mr-1"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"text-gray-700"],["class","text-gray-700",4,"ngIf"],["class","mt-2 flex items-center gap-2",4,"ngIf"],["class","list-disc pl-5 text-gray-700",4,"ngIf"],[1,"p-4","bg-red-100","text-red-700","rounded-lg","mb-4","animate-fade-in"],[1,"mt-2","flex","items-center","gap-2"],[1,"font-semibold","text-gray-800"],[1,"p-1","border","rounded","text-sm","focus:outline-none","focus:ring-2","focus:ring-[var(--main-color)]",3,"ngModelChange","ngModel"],["value","preparing",4,"ngIf"],["value","in-progress",4,"ngIf"],["value","recieved",4,"ngIf"],[1,"px-3","py-1","bg-[var(--main-color)]","text-white","rounded","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-all","duration-300",3,"click","disabled"],["value","preparing"],["value","in-progress"],["value","recieved"],[1,"list-disc","pl-5","text-gray-700"],["class","flex items-center gap-2",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2"],["class","w-12 h-12 object-cover rounded",3,"src","alt",4,"ngIf"],[1,"w-12","h-12","object-cover","rounded",3,"src","alt"]],template:function(e,s){e&1&&(a(0,"div",0)(1,"div",1)(2,"aside",2)(3,"div",3)(4,"h2",4),d(5,"Delivery Dashboard"),o(),a(6,"nav")(7,"ul")(8,"li")(9,"a",5),g("click",function(){return s.setView("home")}),_(10,"i",6),d(11," Home "),o()(),a(12,"li")(13,"a",5),g("click",function(){return s.setView("list")}),_(14,"i",7),d(15," All Orders "),o()()()()(),a(16,"div",8)(17,"div",9)(18,"div",10),d(19),o(),a(20,"div",11)(21,"div",12)(22,"p",13),d(23),o(),a(24,"p",14),d(25),o()(),a(26,"div")(27,"a",15),g("click",function(){return s._UserAuthService.logout()}),_(28,"i",16),o()()()()()()(),a(29,"div",17),u(30,_e,6,1,"div",18)(31,Oe,5,2,"div",19)(32,Be,30,19,"div",20),o()()),e&2&&(n(9),I("bg-gray-500",s.view==="home"),n(4),I("bg-gray-500",s.view==="list"||s.view==="details"),n(6),m(" ",s.deliveryPersonName[0]," "),n(4),P(s.deliveryPersonName),n(2),P(s.decodedToken.Role),n(5),l("ngIf",s.view==="home"),n(),l("ngIf",s.view==="list"),n(),l("ngIf",s.view==="details"&&s.selectedOrder))},dependencies:[Z,Y,J,K,Q,X,oe,ne,ae,ie,te,re],styles:[".animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]})};export{ce as DashboardComponent};
